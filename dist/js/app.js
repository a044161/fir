"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function commonCalculateXY(t,e,i){for(var n=0,s=0,r=point_index,o=point_index,c=0;c<5;c++){var a=chess_array[r]?chess_array[r].value:void 0,l=chess_array[o]?chess_array[o].value:void 0;r>t&&!utils.isUndefined(a)?n+=a:utils.isUndefined(a)&&(r=null),o<e&&!utils.isUndefined(l)?s+=l:utils.isUndefined(l)&&(o=null),r-=i,o+=i;var u=n+s-chess_val;if(u>4||u<-4)return!0}return!1}function calculateX(){var t=chess_point[1]-4>0?chess_point[1]-4:1,e=chess_point[1]+4>row_num?row_num:chess_point[1]+4;return t=getPointIndex([chess_point[0],t])-1,e=getPointIndex([chess_point[0],e])+1,commonCalculateXY(t,e,1)}function calculateY(){var t=chess_point[0]-4>0?chess_point[0]-4:1,e=chess_point[0]+4>row_num?row_num:chess_point[0]+4;return t=getPointIndex([t,chess_point[1]])-1,e=getPointIndex([e,chess_point[1]])+1,commonCalculateXY(t,e,row_num)}function calculateZ(){for(var t=row_num+1,e=row_num-1,i=getPointIndex(chess_point),n=0,s=0,r=chess_point[0],o=chess_point[0],c=chess_point[1],a=chess_point[1],l=chess_point[0],u=chess_point[0],f=chess_point[1],_=chess_point[1],h=i,d=i,p=i,v=i,m={min_L:null,min_R:null,max_L:null,max_R:null},g=0;g<5;g++)1!==r&&1!==c&&4!==g||!utils.isNull(m.min_L)?(r-=1,c-=1):m.min_L=getPointIndex([r,c]),1!==o&&a!==row_num&&4!==g||!utils.isNull(m.min_R)?(o-=1,a+=1):m.min_R=getPointIndex([o,a]),l!==row_num&&1!==f&&4!==g||!utils.isNull(m.max_L)?(l+=1,f-=1):m.max_L=getPointIndex([l,f]),u!==row_num&&_!==row_num&&4!==g||!utils.isNull(m.max_R)?(u+=1,_+=1):m.max_R=getPointIndex([u,_]);for(var y=0;y<5;y++){var w=chess_array[h]?chess_array[h].value:void 0,b=chess_array[d]?chess_array[d].value:void 0,C=chess_array[p]?chess_array[p].value:void 0,x=chess_array[v]?chess_array[v].value:void 0;if(h>m.min_L-1&&!utils.isUndefined(w)&&p!==i&&((n+=w)>4||n<-4))return!0;if(d>m.min_R-1&&!utils.isUndefined(b)&&d!==i&&((s+=b)>4||s<-4))return!0;if(p<m.max_L+1&&!utils.isUndefined(C)&&((s+=C)>4||s<-4))return!0;if(v<m.max_R+1&&!utils.isUndefined(x)&&((n+=x)>4||n<-4))return!0;h-=t,d-=e,p+=e,v+=t}return!1}function getPointIndex(t){var e=t[0],i=t[1];return(e-1)*row_num+i-1}function isWin(){return calculateX()||calculateY()||calculateZ()}function count(t,e,i,n){row_num=e,chess_point=i,chess_val=n;var s=getPointIndex(i);return t[s]={},t[s].value=n,t[s].point=chess_point,chess_array=t,point_index=s,{chess_array:t,is_win:isWin()}}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),isObject=function(){return function(t){return t.constructor===Object}}(),isArray=function(){return function(t){return t instanceof Array}}(),isUndefined=function(){return function(t){return void 0===t}}(),isNull=function(){return function(t){return null===t}}(),merge=function(){return function(){for(var t={},e=arguments.length,i=Array(e),n=0;n<e;n++)i[n]=arguments[n];return i.forEach(function(e){if(isObject(e))for(var i in e)t[i]=e[i]}),t}}(),utils={isObject:isObject,isArray:isArray,isUndefined:isUndefined,isNull:isNull,merge:merge},col=function(t){return'<span class="fir__col__line" style="width: '+(t.style?t.style:{}).width+';"></span>'},col$1={col:col},row=function(t){return'<span class="fir__row__line" style="height: '+(t.style?t.style:{}).height+';"></span>'},row$1={row:row},point=function(t){var e=t.style?t.style:{};return'<div class="fir__point__block" \n    data-point="['+t.x+","+t.y+']" \n    style="width: '+e.width+"; height: "+e.height+"; left: "+e.left+"; top: "+e.top+';"></div>'},point$1={point:point},fir_wrapper=function(t){return'\n    <div class="fir">\n        <div class="fir__header">\n            <p class="fir__header__p">当前为：黑方</>\n        </div>\n        <div class="fir__body">\n            '+t+'\n        </div>\n        <div class="fir__side">\n            <button class="fir__button" id="backMoveBtn">悔棋</button>\n            <button class="fir__button" id="resetBtn">重新开始</button>\n        </div>\n    </div>'},fir_col=function(t){return'<div class="fir__col">'+t+"</div>"},fir_row=function(t){return'<div class="fir__row">'+t+"</div>"},fir_point=function(t){return'<div class="fir__point">'+t+"</div>"},frame={fir_wrapper:fir_wrapper,fir_col:fir_col,fir_row:fir_row,fir_point:fir_point},TPL_OBJ=merge(col$1,row$1,point$1,frame),tpl=function(t,e){if("function"==typeof TPL_OBJ[t]||"string"==typeof TPL_OBJ[t])return TPL_OBJ[t](e)},getElement=function(){return function(t){var e=0===t.indexOf("#"),i=0===t.indexOf("."),n=void 0;return document.querySelector?(n=document.querySelector(t),n.length>0&&(n=document.querySelectorAll(t))):(e||i)&&(t=t.slice(1),n=e?document.getElementById(t):i?document.getElementsByClassName(t):document.getElementsByTagName(t)),n}}(),addClass=function(){return function(t,e){var i=t.className.split(" "),n=e.split(" "),s=i.concat(n);t.className=s.join(" ")}}(),removeClass=function(){return function(t,e){var i=t.className.split(" ");e.split(" ").forEach(function(t,e){var n=i.indexOf(t);n>-1&&i.splice(n,1)}),t.className=i.join(" ")}}(),on=function(){return document.addEventListener?function(t,e,i,n){n||(n=!1),t&&e&&i&&t.addEventListener(e,i,n)}:function(t,e,i){t&&e&&i&&t.attachEvent("on"+e,i)}}(),getDataSet=function(){return function(t,e){var i=void 0;i=t.dataset?t.dataset[e]:t.getAttribute(e);try{return JSON.parse(i)}catch(t){return i}}}(),chess_array=void 0,row_num=void 0,chess_point=void 0,point_index=void 0,chess_val=void 0,calculate={getPointIndex:getPointIndex,count:count},FIR=function(){function t(e){_classCallCheck(this,t);var i={id:"",size:14};this.firBoard=[],this.firstChess=1,this.isDisabled=!1,this.winner="",this.squence=[],this.configs=utils.merge(i,e),this.configs.id&&this.init()}return _createClass(t,[{key:"init",value:function(){var t=getElement("#"+this.configs.id),e=this.createRow()+this.createCol()+this.createPoint();t.innerHTML=tpl("fir_wrapper",e);var i=getElement(".fir__point"),n=getElement("#backMoveBtn"),s=getElement("#resetBtn");this.setFirSize(),this.element_title=getElement(".fir__header__p"),on(i,"click",this.handleChessClick.bind(this)),on(n,"click",this.handleBackMove.bind(this)),on(s,"click",this.handleReset.bind(this))}},{key:"setFirSize",value:function(){var t=getElement(".fir"),e=getElement(".fir__body"),i=.8*t.clientWidth,n=i/t.clientHeight*100+"%";e.style.width="80%",e.style.height=n,e.style.position="relative"}},{key:"createRow",value:function(){console.time("create row");for(var t="",e=100/this.configs.size+"%",i=0;i<this.configs.size;i++)t+=tpl("row",{style:{height:e}});return t=tpl("fir_row",t),console.timeEnd("create row"),t}},{key:"createCol",value:function(){console.time("create col");for(var t="",e=100/this.configs.size+"%",i=0;i<this.configs.size;i++)t+=tpl("col",{style:{width:e}});return t=tpl("fir_col",t),console.timeEnd("create col"),t}},{key:"createPoint",value:function(){console.time("create point");var t="",e=Math.pow(this.configs.size+1,2),i=0,n=0,s=void 0,r=void 0,o=100/this.configs.size,c=o/1.2;s=-c/2,r=-c/2;for(var a=0;a<e;a++)a%(this.configs.size+1)==0&&(i++,n=0,0!==a&&(s+=o),r=-c/2),n++,t+=tpl("point",{x:i,y:n,style:{width:c+"%",height:c+"%",top:s+"%",left:r+"%"}}),r+=o;return t=tpl("fir_point",t),console.timeEnd("create point"),t}},{key:"handleBackMove",value:function(){if(0!==this.squence.length){var t=this.squence.pop();this.firBoard[t.index]=void 0,this.firstChess=1===this.firstChess?-1:1,this.element_title.innerHTML="当前为："+(1===this.firstChess?"黑方":"白方"),removeClass(getElement('[data-point="['+t.point+']"]'),"fir__point__block--black fir__point__block--white")}}},{key:"handleReset",value:function(){this.firBoard=[],this.squence.forEach(function(t){removeClass(getElement('[data-point="['+t.point+']"]'),"fir__point__block--black fir__point__block--white")}),this.isDisabled=!1,this.squence=[],this.firstChess=1,this.element_title.innerHTML="当前为：黑方"}},{key:"handleChessClick",value:function(t){var e=t.target;if(e.dataset.point&&!this.isDisabled){var i=getDataSet(e,"point");this.handleChess(i,e)}}},{key:"handleChess",value:function(t,e){var i=!1,n=(t[0]-1)*(this.configs.size+1)+(t[1]-1);if(utils.isUndefined(this.firBoard[n])){1===this.firstChess?addClass(e,"fir__point__block--black"):addClass(e,"fir__point__block--white");var s=calculate.count(this.firBoard,this.configs.size+1,t,this.firstChess);if(this.firBoard=s.chess_array,i=s.is_win,this.squence.push({point:t,index:n}),i)return this.isDisabled=!0,this.winner=1===this.firstChess?"黑方":"白方",void alert("获胜方为："+this.winner);this.firstChess=1===this.firstChess?-1:1,this.element_title.innerHTML="当前为："+(1===this.firstChess?"黑方":"白方")}}}]),t}();window.FIR=FIR;