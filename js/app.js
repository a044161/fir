"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function calculateX(){var t=chess_point[1]-4>0?chess_point[1]-4:1,i=chess_point[1]+4>row_num?row_num:chess_point[1]+4;t=getPointIndex([chess_point[0],t])-1,i=getPointIndex([chess_point[0],i])+1;for(var n=0,e=0,s=point_index,r=point_index,o=0;o<5;o++){s>t&&!utils.isUndefined(chess_array[s])?n+=chess_array[s]:utils.isUndefined(chess_array[s])&&(s=null),r<i&&!utils.isUndefined(chess_array[r])?e+=chess_array[r]:utils.isUndefined(chess_array[r])&&(r=null),s--,r++;var c=n+e-chess_val;if(c>4||c<-4)return!0}return!1}function calculateY(){var t=row_num,i=chess_point[0]-4>0?chess_point[0]-4:1,n=chess_point[0]+4>row_num?row_num:chess_point[0]+4;i=getPointIndex([i,chess_point[1]])-1,n=getPointIndex([n,chess_point[1]])+1;for(var e=0,s=0,r=point_index,o=point_index,c=0;c<5;c++){r>i&&!utils.isUndefined(chess_array[r])?e+=chess_array[r]:utils.isUndefined(chess_array[r])&&(r=null),o<n&&!utils.isUndefined(chess_array[o])?s+=chess_array[o]:utils.isUndefined(chess_array[o])&&(o=null),r-=t,o+=t;var a=e+s-chess_val;if(a>4||a<-4)return!0}return!1}function calculateZ(){for(var t=row_num+1,i=row_num-1,n=getPointIndex(chess_point),e=0,s=0,r=chess_point[0],o=chess_point[0],c=chess_point[1],a=chess_point[1],l=chess_point[0],u=chess_point[0],f=chess_point[1],_=chess_point[1],h=n,d=n,p=n,m=n,v={min_L:null,min_R:null,max_L:null,max_R:null},y=0;y<5;y++)1!==r&&1!==c&&4!==y||!utils.isNull(v.min_L)?(r-=1,c-=1):v.min_L=getPointIndex([r,c]),1!==o&&a!==row_num&&4!==y||!utils.isNull(v.min_R)?(o-=1,a+=1):v.min_R=getPointIndex([o,a]),l!==row_num&&1!==f&&4!==y||!utils.isNull(v.max_L)?(l+=1,f-=1):v.max_L=getPointIndex([l,f]),u!==row_num&&_!==row_num&&4!==y||!utils.isNull(v.max_R)?(u+=1,_+=1):v.max_R=getPointIndex([u,_]);for(var g=0;g<5;g++){var w=chess_array[h],x=chess_array[d],C=chess_array[p],P=chess_array[m];if(h>v.min_L-1&&!utils.isUndefined(w)&&p!==n&&((e+=w)>4||e<-4))return!0;if(d>v.min_R-1&&!utils.isUndefined(x)&&d!==n&&((s+=x)>4||s<-4))return!0;if(p<v.max_L+1&&!utils.isUndefined(C)&&((s+=C)>4||s<-4))return!0;if(m<v.max_R+1&&!utils.isUndefined(P)&&((e+=P)>4||e<-4))return!0;h-=t,d-=i,p+=i,m+=t}return!1}function getPointIndex(t){var i=t[0],n=t[1];return(i-1)*row_num+n-1}function isWin(){return calculateX()||calculateY()||calculateZ()}function count(t,i,n,e){row_num=i,chess_point=n,chess_val=e;var s=getPointIndex(n);return t[s]=e,chess_array=t,point_index=s,t}var _createClass=function(){function t(t,i){for(var n=0;n<i.length;n++){var e=i[n];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(i,n,e){return n&&t(i.prototype,n),e&&t(i,e),i}}(),isObject=function(){return function(t){return t.constructor===Object}}(),isArray=function(){return function(t){return t instanceof Array}}(),isUndefined=function(){return function(t){return void 0===t}}(),isNull=function(){return function(t){return null===t}}(),merge=function(){return function(){for(var t={},i=arguments.length,n=Array(i),e=0;e<i;e++)n[e]=arguments[e];return n.forEach(function(i){if(isObject(i))for(var n in i)t[n]=i[n]}),t}}(),utils={isObject:isObject,isArray:isArray,isUndefined:isUndefined,isNull:isNull,merge:merge},col=function(t){return'<span class="fir__col__line" style="width: '+(t.style?t.style:{}).width+';"></span>'},col$1={col:col},row=function(t){return'<span class="fir__row__line" style="height: '+(t.style?t.style:{}).height+';"></span>'},row$1={row:row},point=function(t){var i=t.style?t.style:{};return'<div class="fir__point__block" \n    data-point="['+t.x+","+t.y+']" \n    style="width: '+i.width+"; height: "+i.height+"; left: "+i.left+"; top: "+i.top+';"></div>'},point$1={point:point},fir_wrapper=function(t){return'<div class="fir">'+t+"</div>"},fir_col=function(t){return'<div class="fir__col">'+t+"</div>"},fir_row=function(t){return'<div class="fir__row">'+t+"</div>"},fir_point=function(t){return'<div class="fir__point">'+t+"</div>"},frame={fir_wrapper:fir_wrapper,fir_col:fir_col,fir_row:fir_row,fir_point:fir_point},TPL_OBJ=merge(col$1,row$1,point$1,frame),tpl=function(t,i){if("function"==typeof TPL_OBJ[t]||"string"==typeof TPL_OBJ[t])return TPL_OBJ[t](i)},getElement=function(){return function(t){var i=0===t.indexOf("#"),n=0===t.indexOf("."),e=void 0;return document.querySelector?(e=document.querySelector(t),e.length>0&&(e=document.querySelectorAll(t))):(i||n)&&(t=t.slice(1),e=i?document.getElementById(t):n?document.getElementsByClassName(t):document.getElementsByTagName(t)),e}}(),addClass=function(){return function(t,i){var n=t.className.split(" "),e=i.split(" "),s=n.concat(e);t.className=s.join(" ")}}(),on=function(){return document.addEventListener?function(t,i,n,e){e||(e=!1),t&&i&&n&&t.addEventListener(i,n,e)}:function(t,i,n){t&&i&&n&&t.attachEvent("on"+i,n)}}(),getDataSet=function(){return function(t,i){var n=void 0;n=t.dataset?t.dataset[i]:t.getAttribute(i);try{return JSON.parse(n)}catch(t){return n}}}(),chess_array=void 0,row_num=void 0,chess_point=void 0,point_index=void 0,chess_val=void 0,calculate={getPointIndex:getPointIndex,count:count,isWin:isWin},FIR=function(){function t(i){_classCallCheck(this,t);var n={id:"",size:14};this.firBoard=[],this.firstChess=1,this.isDisabled=!1,this.winner="",this.configs=utils.merge(n,i),this.configs.id&&this.init()}return _createClass(t,[{key:"init",value:function(){this.element=getElement("#"+this.configs.id);var t=this.createRow()+this.createCol()+this.createPoint();this.element.innerHTML=tpl("fir_wrapper",t);var i=getElement(".fir__point");on(i,"click",this.handleChess.bind(this))}},{key:"createRow",value:function(){console.time("create row");for(var t="",i=100/this.configs.size+"%",n=0;n<this.configs.size;n++)t+=tpl("row",{style:{height:i}});return t=tpl("fir_row",t),console.timeEnd("create row"),t}},{key:"createCol",value:function(){console.time("create col");for(var t="",i=100/this.configs.size+"%",n=0;n<this.configs.size;n++)t+=tpl("col",{style:{width:i}});return t=tpl("fir_col",t),console.timeEnd("create col"),t}},{key:"createPoint",value:function(){console.time("create point");var t="",i=Math.pow(this.configs.size+1,2),n=0,e=0,s=void 0,r=void 0,o=100/this.configs.size,c=o/1.2;s=-c/2,r=-c/2;for(var a=0;a<i;a++)a%(this.configs.size+1)==0&&(n++,e=0,0!==a&&(s+=o),r=-c/2),e++,t+=tpl("point",{x:n,y:e,style:{width:c+"%",height:c+"%",top:s+"%",left:r+"%"}}),r+=o;return t=tpl("fir_point",t),console.timeEnd("create point"),t}},{key:"handleChess",value:function(t){var i=t.target;if(i.dataset.point&&!this.isDisabled){var n=getDataSet(i,"point"),e=(n[0]-1)*(this.configs.size+1)+(n[1]-1);if(!utils.isUndefined(this.firBoard[e]))return;if(1===this.firstChess?addClass(i,"fir__point__block--black"):addClass(i,"fir__point__block--white"),this.firBoard=calculate.count(this.firBoard,this.configs.size+1,n,this.firstChess),calculate.isWin())return this.isDisabled=!0,this.winner=1===this.firstChess?"黑方":"白方",void alert("获胜方为："+this.winner);this.firstChess=1===this.firstChess?-1:1}}}]),t}();window.FIR=FIR;